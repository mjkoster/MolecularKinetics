---
info: 
  title: onefb analog input object
  version: 2021-09-05
  copyright: "Copyright 2021, Michael J. Koster. All rights reserved."
  license: "https://github.com/one-data-model/oneDM/blob/master/LICENSE"

namespace: onefb: https://onedm.org/village/onefb

defaultnamespace: onefb

sdfObject: 
  AnalogInput: 
    sdfRef: /#/sdfObject/BaseObject
    Description: "Module for analog input, does value scaling and unit binding of a PresentValue property"
    ObjectTypeID: 4900,

    sdfProperty:
      PresentValue:
        type: number
      Unit: 
        type: string
        default: %
      UnitMinimum:
        type: number
        default: 0
      UnitMaximum:
        type: number
        default: 100
      UnitResolution:
        type: number
        default: .1
      OutputLink:
        sdfRef: /#/sdfData/ObjectLink
      SourceValue:
        type: number
      SourceMinimum:
        type: number
        default: 0
      SourceMaximum:
        type: number
        default: 1023
      CurrentTime:
        type: number
      LastExecuteTime:
        type: number
      ExecuteInterval:
        type: number
      SourceLink:
        sdfRef: /#/sdfData/ObjectLink

    sdfAction:
      ConvertToPresentValue:
        Description: Convert source range to Unit range ->
                       PresentValue = ( SourceValue-SourceMinimum * 
                       UnitMaximum-UnitMinimum / SourceMaximum-SourceMinimum )
                       + UnitMinimum % UnitResolution
        sdfInput: 
          SourceValue: 
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/SourceValue"
          SourceMinimum:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/SourceMinimum"
          SourceMaximum:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/SourceMaximum"
          UnitMinimum:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/UnitMinimum"
          UnitMaximum:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/UnitMaximum"
        sdfOutput:
          PresentValue:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/PresentValue"

      UpdateLinkedObject:
        Description: Transfer the OutputValue contents to the InputValue property 
                     or to the PresentValue property of the objects pointed to 
                     by the OutputLink
        sdfInput:
          PresentValue:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/PresentValue"
          OutputLink:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/OutputLink"

      TimeoutFunction:
        Description: Execute when LastExecuteTime + ExecuteInterval > CurrentTIme (single wrap-around tolerant)
                     Fetch the value of the PresentValue property of the object pointed to by the Input Link and
                     update the SourceValue, resulting in conversion, PresentValue update, and output link processing
        sdfInput:
          SourceLink:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/SourceLink"
        sdfOutput:
          SourceValue:
            sdfLink: "#/sdfObject/AnalogInput/sdfProperty/SourceValue"
